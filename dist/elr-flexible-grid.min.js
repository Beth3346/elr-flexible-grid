!function($){window.elrFlexibleGrid=function(params){var tags,self={},spec=params||{},gridClass=spec.gridClass||"elr-flexible-grid",imagesPerRow=spec.imagesPerRow||4,flex=spec.flex||!0,$grid=$("."+gridClass),addFilterButtons=function(tags){$.each(tags,function(k,v){var $tagButton=$("<button></button>",{"class":"elr-grid-filter",text:elr.capitalize(v),"data-filter":v});$tagButton.appendTo($gridNav)}),$gridNav.find(".elr-grid-filter").first().addClass("active")},resizeOverlay=function(){var overlay=$grid.find(".overlay");$.each(overlay,function(k,v){var $that=$(v),imageHeight=$that.parent(".elr-grid-item").find("img").outerHeight(!0);$that.height(imageHeight).hide()})},addListItems=function($items){$grid.empty(),$items.appendTo($grid).hide(0,function(){positionListItems($items)})},positionListItems=function($items){var resizeHolder=function($items){for(var tallestColumn=0,columnHeights=[],i=0;imagesPerRow>i;i++)columnHeights.push(0);$.each($items,function(k,v){var $that=$(v),columnNum=$that.data("column"),height=$that.outerHeight(!0);return columnHeights[columnNum]+=height}),$.each(columnHeights,function(k,v){return v>tallestColumn?tallestColumn=v:void 0}),$grid.css({height:tallestColumn+40})};$.each($items,function(k,v){var $that=$(v),index=k+1,columnNum=index%imagesPerRow===0?imagesPerRow-1:index%imagesPerRow-1,$prevImage=index>imagesPerRow?$grid.find(".elr-grid-item").eq(index-(imagesPerRow+1)):null;if($that.attr("data-column",columnNum),$that.attr("data_num",index),"undefined"!=typeof $prevImage&&null!==$prevImage){var margin=$prevImage.outerWidth(!0)-$prevImage.outerWidth(!1),top=index<2*self.imagesPerRow+1?$prevImage.outerHeight(!1)+margin:$prevImage.outerHeight(!1)+margin+$prevImage.position().top;left=$prevImage.outerWidth(!1)*columnNum+margin*columnNum,$that.css({top:top,left:left,position:"absolute"})}else $that.css({top:0,left:0,position:"relative"});$that.show()}),resizeHolder($items)},filterListItems=function(filter,$items){var $filteredItems;filter=window.location.hash?filter:"all",window.location.hash=filter,-1!==$.inArray(filter,tags)||"all"===filter?($filteredItems="all"===filter?$items:$items.has("ul.caption-tags li:containsNC("+filter+")"),addListItems($filteredItems)):$("<p></p>",{text:"no items match"}).appendTo($grid)};if($grid.length){var hash=window.location.hash;$gridNav=$(".elr-grid-nav"),$items=$grid.find(".elr-grid-item").hide(),$(window).load(function(){var filter=hash?hash.replace(/^#/,""):null;if(tags=elr.toArray($grid.find("ul.caption-tags li"),!0),addFilterButtons(tags),filterListItems(filter,$items),"undefined"!=typeof filter){var $activeButton=$("button.elr-grid-filter[data-filter="+filter+"]");$activeButton.siblings("button").removeClass("active"),$activeButton.addClass("active")}}),flex===!0&&$(window).resize(function(){positionListItems($items),resizeOverlay()}),$(window).load(resizeOverlay),$grid.on("mouseenter",".elr-grid-item",function(){$(this).find(".overlay").stop().fadeIn("fast")}),$grid.on("mouseleave",".elr-grid-item",function(){$(this).find(".overlay").stop().fadeOut("fast")}),$gridNav.on("click","button.elr-grid-filter",function(e){var $that=$(this),filter=$that.data("filter").toLowerCase();filterListItems(filter,$items),$that.siblings("button").removeClass("active"),$that.addClass("active"),e.preventDefault()}),$grid.on("click",".caption-tags li",function(e){var filter=$(this).data("filter").toLowerCase();filterListItems(filter,$items),$button=$gridNav.find("button[data-filter="+filter+"]"),$button.siblings("button").removeClass("active"),$button.addClass("active"),e.preventDefault()})}return self}}(jQuery);